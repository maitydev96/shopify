{"version":3,"sources":["/var/gadget/codegen/framework-1756630026360-Css7ce/src/bigcommerce/effects.ts"],"sourcesContent":["import type { GadgetRecord } from \"@gadgetinc/api-client-core\";\nimport { validateBelongsToLink } from \"../auth.js\";\nimport { getActionContextFromLocalStorage } from \"../effects.js\";\nimport { AppTenancyKey } from \"../tenancy.js\";\nimport type { AnyParams } from \"../types.js\";\n\n/**\n * Applicable for multi-tenant Store apps(public apps)\n * Enforces that the given record is only accessible by the current store or customer\n * *\n * @param params - incoming data validated against the current `storeHash`\n * @param record - record used to validate or set the `storeHash` on\n */\nexport async function preventCrossStoreDataAccess(\n  params: AnyParams,\n  record: GadgetRecord<any>,\n  options?: { storeBelongsToField?: string }\n): Promise<void> {\n  const context = getActionContextFromLocalStorage();\n\n  if (context.type != \"effect\") {\n    throw new Error(\"Can't prevent cross store data access outside of an action effect\");\n  }\n  if (!params) {\n    throw new Error(\"The `params` parameter is required in preventCrossStoreDataAccess(params, record)\");\n  }\n  if (!record) {\n    throw new Error(\"The `record` parameter is required in preventCrossStoreDataAccess(params, record)\");\n  }\n\n  const model = context.model;\n  const appTenancy = context[AppTenancyKey];\n\n  // if there's no tenancy let's continue\n  if (appTenancy?.bigcommerce?.storeId === undefined) {\n    return;\n  }\n\n  // if this effect is not run in the context of a model then it does not apply\n  if (!model) {\n    return;\n  }\n\n  const input = params[model.apiIdentifier];\n  const storeBelongsToField = options?.storeBelongsToField;\n  validateBelongsToLink({\n    input,\n    record,\n    params,\n    model,\n    tenantId: appTenancy.bigcommerce.storeId,\n    tenantModelKey: bigcommerceStoreKey,\n    tenantBelongsToField: storeBelongsToField,\n    tenantType: TenantType.Store,\n    tenantName: \"BigCommerce\",\n  });\n}\n\nconst bigcommerceModelKey = (modelName: string): string => {\n  const modelKey = modelName.replaceAll(\" \", \"\");\n  return `DataModel-BigCommerce-${modelKey}`;\n};\n\nconst bigcommerceStoreKey: string = bigcommerceModelKey(\"Store\");\n\nconst enum TenantType {\n  Store = \"store\",\n}\n"],"names":["validateBelongsToLink","getActionContextFromLocalStorage","AppTenancyKey","preventCrossStoreDataAccess","params","record","options","context","type","Error","model","appTenancy","bigcommerce","storeId","undefined","input","apiIdentifier","storeBelongsToField","tenantId","tenantModelKey","bigcommerceStoreKey","tenantBelongsToField","tenantType","tenantName","bigcommerceModelKey","modelName","modelKey","replaceAll"],"mappings":"AACA,SAASA,qBAAqB,QAAQ,aAAa;AACnD,SAASC,gCAAgC,QAAQ,gBAAgB;AACjE,SAASC,aAAa,QAAQ,gBAAgB;AAG9C;;;;;;CAMC,GACD,OAAO,eAAeC,4BACpBC,MAAiB,EACjBC,MAAyB,EACzBC,OAA0C;IAE1C,MAAMC,UAAUN;IAEhB,IAAIM,QAAQC,IAAI,IAAI,UAAU;QAC5B,MAAM,IAAIC,MAAM;IAClB;IACA,IAAI,CAACL,QAAQ;QACX,MAAM,IAAIK,MAAM;IAClB;IACA,IAAI,CAACJ,QAAQ;QACX,MAAM,IAAII,MAAM;IAClB;IAEA,MAAMC,QAAQH,QAAQG,KAAK;IAC3B,MAAMC,aAAaJ,OAAO,CAACL,cAAc;IAEzC,uCAAuC;IACvC,IAAIS,YAAYC,aAAaC,YAAYC,WAAW;QAClD;IACF;IAEA,6EAA6E;IAC7E,IAAI,CAACJ,OAAO;QACV;IACF;IAEA,MAAMK,QAAQX,MAAM,CAACM,MAAMM,aAAa,CAAC;IACzC,MAAMC,sBAAsBX,SAASW;IACrCjB,sBAAsB;QACpBe;QACAV;QACAD;QACAM;QACAQ,UAAUP,WAAWC,WAAW,CAACC,OAAO;QACxCM,gBAAgBC;QAChBC,sBAAsBJ;QACtBK,UAAU;QACVC,YAAY;IACd;AACF;AAEA,MAAMC,sBAAsB,CAACC;IAC3B,MAAMC,WAAWD,UAAUE,UAAU,CAAC,KAAK;IAC3C,OAAO,CAAC,sBAAsB,EAAED,UAAU;AAC5C;AAEA,MAAMN,sBAA8BI,oBAAoB"}