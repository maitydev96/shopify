{"version":3,"sources":["/var/gadget/codegen/framework-1756630026360-Css7ce/src/vite/index.ts"],"sourcesContent":["import { getHtmlTags, getViteConfig } from \"./helpers\";\nimport { GadgetPluginOptions } from \"./types\";\nimport { patchOverlay } from \"../core/errors/overlay\";\n\n/**\n * Vite plugin that is used to configure the Vite build process for the Gadget application.\n */\nexport const gadget = (options?: GadgetPluginOptions) => {\n  \n\n  /**\n   * Available frontend type:\n   * - \"remix\"\n   * - \"react-router-framework\"\n   * - \"vite\"\n   */\n  let frontendType: any;\n  let command: \"serve\" | \"build\";\n\n  return {\n    name: \"gadget-vite-plugin\",\n    config: async (config: any, env: any) => {\n      \n        const result = await getViteConfig(config, env, {\n          plugin: options,\n          params: {\n            assetsBucketDomain: \"app-assets.gadget.dev\",\n            applicationId: \"265761\",\n            productionEnvironmentId: \"525584\",\n            developmentEnvironmentVariables: {\"GADGET_APP\":\"shopifyapp-dw5d\",\"GADGET_ENV\":\"development\",\"GADGET_PUBLIC_APP_SLUG\":\"shopifyapp-dw5d\",\"GADGET_ENV_ID\":\"525583\",\"GADGET_PUBLIC_APP_ENV\":\"development\",\"GADGET_APP_TEMPLATE_TYPE\":\"ShopifyApp\",\"GADGET_FLAG_ASSISTANT_ENABLED\":\"true\"},\n            productionEnvironmentVariables: {\"GADGET_APP\":\"shopifyapp-dw5d\",\"GADGET_ENV\":\"production\",\"GADGET_PUBLIC_APP_SLUG\":\"shopifyapp-dw5d\",\"GADGET_ENV_ID\":\"525584\",\"GADGET_PUBLIC_APP_ENV\":\"production\",\"GADGET_APP_TEMPLATE_TYPE\":\"ShopifyApp\"},\n            useSameDomainAssets: false,\n          },\n        });\n\n        frontendType = result.type;\n        command = result.command;\n\n        return result.config;\n      \n    },\n    transformIndexHtml: {\n      order: \"pre\",\n      handler: (html: string, { server }: any) => {\n        \n        if(frontendType !== \"vite\") {\n          return [];\n        }\n\n        const tags = getHtmlTags({\n          hasAppBridgeV4: true,\n          hasBigCommerceConnection: false,\n          assetsDomain: \"assets.gadget.dev\",\n          hasShopifyConnection: true,\n        }, !!server);\n\n        return tags;\n        \n      }\n    },\n    transform(src: any, id: any, opts: any) {\n      \n      if (id.includes(\"vite/dist/client/client.mjs\")) {\n        if (opts.ssr) return;\n        return {\n          code: patchOverlay(src, \"development\"),\n          };\n        }\n      \n\n      if(frontendType !== \"vite\" && command === \"serve\" && (id.endsWith(\"/web/root.tsx\") || id.endsWith(\"/web/root.jsx\"))) {\n        return {\n          code: src + `\nif(typeof window !== \"undefined\") {\n  const script = window.document.createElement(\"script\");\n  script.src = \"https://assets.gadget.dev/assets/devHarness.min.js\";\n  window.document.head.appendChild(script);\n\n  // We need to be able to access the Vite HMR object in dev harness, so we leak it into the window object with a proxy.\n  window.__gadget_vite_hmr_connection = new Proxy(import.meta.hot, {\n    get(target, prop) {\n      return target[prop];\n    },\n    set() {\n      return false;\n    }\n  });\n\n\n  const originalParams = window.location.search;\n  if (import.meta.hot) {\n    const replaceParams = () => {\n      const currentParams = new URLSearchParams(window.location.search);\n      if (!currentParams.has(\"hmac\") && history) {\n        history.pushState({}, \"\", window.location.pathname + originalParams);\n      }\n    }\n    import.meta.hot.on(\"vite:beforeFullReload\", replaceParams);\n    import.meta.hot.on(\"vite:ws:disconnect\", replaceParams);\n  }\n\n}\n`\n        }\n      }\n    }\n  } as any;\n}\n"],"names":["gadget","options","frontendType","command","name","config","env","result","getViteConfig","plugin","params","assetsBucketDomain","applicationId","productionEnvironmentId","developmentEnvironmentVariables","productionEnvironmentVariables","useSameDomainAssets","type","transformIndexHtml","order","handler","html","server","tags","getHtmlTags","hasAppBridgeV4","hasBigCommerceConnection","assetsDomain","hasShopifyConnection","transform","src","id","opts","includes","ssr","code","patchOverlay","endsWith"],"mappings":";;;;+BAOaA;;;eAAAA;;;yBAP8B;yBAEd;AAE7B;;CAEC,GACM,MAAMA,SAAS,CAACC;IAGrB;;;;;GAKC,GACD,IAAIC;IACJ,IAAIC;IAEJ,OAAO;QACLC,MAAM;QACNC,QAAQ,OAAOA,QAAaC;YAExB,MAAMC,SAAS,MAAMC,IAAAA,sBAAa,EAACH,QAAQC,KAAK;gBAC9CG,QAAQR;gBACRS,QAAQ;oBACNC,oBAAoB;oBACpBC,eAAe;oBACfC,yBAAyB;oBACzBC,iCAAiC;wBAAC,cAAa;wBAAkB,cAAa;wBAAc,0BAAyB;wBAAkB,iBAAgB;wBAAS,yBAAwB;wBAAc,4BAA2B;wBAAa,iCAAgC;oBAAM;oBACpRC,gCAAgC;wBAAC,cAAa;wBAAkB,cAAa;wBAAa,0BAAyB;wBAAkB,iBAAgB;wBAAS,yBAAwB;wBAAa,4BAA2B;oBAAY;oBAC1OC,qBAAqB;gBACvB;YACF;YAEAd,eAAeK,OAAOU,IAAI;YAC1Bd,UAAUI,OAAOJ,OAAO;YAExB,OAAOI,OAAOF,MAAM;QAExB;QACAa,oBAAoB;YAClBC,OAAO;YACPC,SAAS,CAACC,MAAc,EAAEC,MAAM,EAAO;gBAErC,IAAGpB,iBAAiB,QAAQ;oBAC1B,OAAO,EAAE;gBACX;gBAEA,MAAMqB,OAAOC,IAAAA,oBAAW,EAAC;oBACvBC,gBAAgB;oBAChBC,0BAA0B;oBAC1BC,cAAc;oBACdC,sBAAsB;gBACxB,GAAG,CAAC,CAACN;gBAEL,OAAOC;YAET;QACF;QACAM,WAAUC,GAAQ,EAAEC,EAAO,EAAEC,IAAS;YAEpC,IAAID,GAAGE,QAAQ,CAAC,gCAAgC;gBAC9C,IAAID,KAAKE,GAAG,EAAE;gBACd,OAAO;oBACLC,MAAMC,IAAAA,qBAAY,EAACN,KAAK;gBACxB;YACF;YAGF,IAAG5B,iBAAiB,UAAUC,YAAY,WAAY4B,CAAAA,GAAGM,QAAQ,CAAC,oBAAoBN,GAAGM,QAAQ,CAAC,gBAAe,GAAI;gBACnH,OAAO;oBACLF,MAAML,MAAM,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BvB,CAAC;gBACO;YACF;QACF;IACF;AACF"}